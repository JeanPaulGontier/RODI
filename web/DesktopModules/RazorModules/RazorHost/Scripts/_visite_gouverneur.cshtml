@using AIS
@{
    if (Functions.CurrentCric!=0)
    {
        if (IsPost && (""+Request["bt_download"])!="")
        {
            try
            {
                var a = Functions.GetRotaryYear();
                Media media = DataMapping.ExportFicheRenseignementClub("RC "+Functions.ClearFileName(Functions.CurrentClub.name)+" "+(a-2000)+"-"+(a+1-2000)+".xlsx");
                if (media==null)
                {
                    <div class="alert alert-danger">Fichier de gabarit introuvable</div>
                    return;
                }
                string guidexport = Guid.NewGuid().ToString();
                Session[guidexport] = media;
                Response.Redirect(Const.MEDIA_DOWNLOAD_URL + "?id=" + guidexport);
                return;
            }
            catch (Exception ee)
            {
                Functions.Error(ee);

                <div class="alert alert-danger">Une erreur est survenue : @ee.Message</div>
                return;
            }

        }

        <div class="alert alert-info">
            Vous pouvez télécharger la fiche de renseignement du club afin de préparer la visite du gouverneur
        </div>
        <div class="text-right"><button type="submit" name="bt_download" value="download" class="btn btn-primary">Télécharger</button></div>
    }
    else
    {
        <div class="alert alert-warning">
            Veuillez choisir un club...
        </div>
    }
}
